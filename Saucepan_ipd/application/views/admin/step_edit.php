<?php $this->load->view('admin/header')?><script type='text/javascript' src='<?php echo base_url()?>themes/default/js/fileuploader.js'></script><?php $lancodelist = getlancodelist();?><script type="text/javascript">//步骤---编辑function tosave_stepinfo(step_id){	var lancodelist = getlancodelist();	if(isajaxsaveing == 0){		//具体点击的按钮		actionsubmit_button = $('div[onclick="tosave_stepinfo('+step_id+')"]');		//ajax正在保存中		isajaxsaveing = 1;		//返回url		var backurl = $('input[name="backurl"]').val();		//将提交按钮设置为保存中		actionsubmit_button.attr('class', 'gksel_btn_action_off');		actionsubmit_button.html('<img class="icon_loading" src="'+baseurl+'themes/default/images/ajax_loading.gif"/><span>'+L['cy_saving']+'...</span>');						//----定义的字段------START			var GETOBJ = [];			var GETOBJ_num = 0;			GETOBJ[GETOBJ_num] = new Array();			GETOBJ[GETOBJ_num]['field_name'] = 'status';			GETOBJ[GETOBJ_num]['field_realname'] = 'status';			GETOBJ[GETOBJ_num]['field_type'] = "checkboxradio";			GETOBJ[GETOBJ_num]['field_CMNAME'] = L['cy_status'];						GETOBJ_num = GETOBJ_num + 1;			GETOBJ[GETOBJ_num] = new Array();			GETOBJ[GETOBJ_num]['field_name'] = 'img1_gksel';			GETOBJ[GETOBJ_num]['field_realname'] = 'step_logo';			GETOBJ[GETOBJ_num]['field_type'] = "image";			GETOBJ[GETOBJ_num]['field_CMNAME'] = '';		//----定义的字段------END					//----定义多语言的字段------START			var GETLANGOBJ = new Array();			var GETLANGOBJ_num = 0;			GETLANGOBJ[GETLANGOBJ_num] = new Array();			GETLANGOBJ[GETLANGOBJ_num]['field_name'] = 'step_name';			GETLANGOBJ[GETLANGOBJ_num]['field_type'] = "input";			GETLANGOBJ[GETLANGOBJ_num]['field_CMNAME'] = '';		//----定义多语言的字段------END				var returnOBJ = checkjsformcontent(lancodelist, GETOBJ, GETLANGOBJ);//----定义字段变量, 检查是否为空或格式错误------START		var postOBJ = returnOBJ.postOBJ;		postOBJ.backurl = backurl;		postOBJ.GETOBJ = returnOBJ.GETOBJ_arr;		postOBJ.GETOBJ_type = returnOBJ.GETOBJ_type_arr;		postOBJ.GETOBJ_realname = returnOBJ.GETOBJ_realname_arr;		postOBJ.GETLANGOBJ = returnOBJ.GETLANGOBJ_arr;		if(returnOBJ.ispass == 1){			$.post(baseurl+'index.php/admins/step/editstep/'+step_id, postOBJ, function (data){				console.log(data);				var obj = eval( "(" + data + ")" );				actionsubmit_button.html('<img class="icon_success" src="'+baseurl+'themes/default/images/global_ok.png"/><span>'+L['cy_save_success']+'</span>');				location.href = obj.backurl;			})		}else{			actionsubmit_button.attr('class', 'gksel_btn_action_on');			actionsubmit_button.html(L['cy_save']);			isajaxsaveing = 0;//ajax正在保存中 --- 释放		}	}}</script><form method="post">	<table class="gksel_normal_tabpost">		<tr>			<td align="right"><?php echo lang('dz_product_picture')?></td>			<td>				<div class="img_gksel_show" id="img1_gksel_show">					<?php 						$img1_gksel = '';						if(file_exists($stepinfo['step_logo']) && $stepinfo['step_logo']!=""){							$img1_gksel = $stepinfo['step_logo'];							echo '<img style="float:left;max-width:400px;max-height:400px;" src="'.base_url().$stepinfo['step_logo'].'" />';						}					?>				</div>				<div class="img_gksel_choose" id="img1_gksel_choose">上传图片</div>				<div style="float:left;"><input type="hidden" id="img1_gksel" name="img1_gksel" value="<?php echo $img1_gksel;?>"/></div>				<div style="float:left;margin-left:5px;margin-top:5px;"><font class="fonterror" id="img1_gksel_error"><font style="color:gray;">仅支持 Jpg, Png, Gif (617px * 540px)</font></div>			</td>		</tr>		<?php for ($lc = 0; $lc < count($lancodelist); $lc++) {?>			<tr>				<td align="right" width="150"><?php if($this->langtype == '_ch'){echo '步骤名称';}else{echo 'Step Name';}?> <?php if(count($lancodelist) != 1){echo '('.$lancodelist[$lc]['langname'].')';}?></td>				<td align="left">					<input type="text" name="step_name<?php echo  $lancodelist[$lc]['langtype']?>" style="width:300px;" value="<?php echo $stepinfo[ 'step_name'. $lancodelist[$lc]['langtype']]?>"/>					<div class="tipsgroupbox"><div class="request">*</div></div>				</td>			</tr>		<?php }?>		<tr style="display: none;">			<td align="right" width="150"><?php echo lang('cy_status')?></td>			<td align="left">				<input name="status" type="checkbox" defaultvalue="0" class="mgc-switch" value="1" <?php if($stepinfo['status'] == 1){echo 'checked';}?>/>			</td>		</tr>		<tr>			<td>				<input name="backurl" type="hidden" value="<?php echo $backurl;?>"/>			</td>			<td align="left">				<div class="gksel_btn_action_on" onclick="tosave_stepinfo(<?php echo $stepinfo["step_id"]?>)"><?php echo lang('cy_save')?></div>			</td>		</tr>	</table></form><script type="text/javascript">$(document).ready(function(){	var button_gksel1 = $('#img1_gksel_choose'), interval;	if(button_gksel1.length>0){		new AjaxUpload(button_gksel1,{			action: baseurl+'index.php/welcome/uplogo/617/540', 			name: 'logo',onSubmit : function(file, ext){				if (ext && /^(jpg|png|gif)$/.test(ext)){					button_gksel1.text('上传中');					this.disable();					interval = window.setInterval(function(){						var text = button_gksel1.text();						if (text.length < 13){							button_gksel1.text(text + '.');											} else {							button_gksel1.text('上传中');										}					}, 200);				} else {					$('#img1_gksel_error').html('上传失败');					return false;				}			},			onComplete: function(file, response){				button_gksel1.text('上传图片');										window.clearInterval(interval);				this.enable();				if(response=='false'){					$('#img1_gksel_error').html('上传失败');				}else{					var pic = eval("("+response+")");					$('#img1_gksel_show').html('<img style="float:left;max-width:400px;max-height:400px;" src="'+baseurl+pic.logo+'" />');					$('#img1_gksel').attr('value',pic.logo);					$('#img1_gksel_error').html('');				}				}		});	}})</script><?php $this->load->view('admin/footer')?>